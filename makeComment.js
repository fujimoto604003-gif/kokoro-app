export const makeParentingComment = (answers) => {
    // Validate input
    if (!answers || answers.length !== 15) {
        return { text: "ã‚¨ãƒ©ãƒ¼: å›ç­”ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚(15å•å¿…è¦ã§ã™)" };
    }

    // --- Constants & Data (Ported from existing Python app) ---

    // Q1-Q15 to Domain Mapping
    // Domain names must match keys in DIAGNOSTIC_FEEDBACK
    const QUESTIONS = [
        // Domain I: æ„›ç€ãƒ»å–œã³
        { id: "Q1", domain: "I. æ„›ç€ãƒ»å–œã³" },
        { id: "Q2", domain: "I. æ„›ç€ãƒ»å–œã³" },
        // Domain II: åŠ¹åŠ›æ„Ÿ
        { id: "Q3", domain: "II. åŠ¹åŠ›æ„Ÿ" },
        { id: "Q4", domain: "II. åŠ¹åŠ›æ„Ÿ" },
        // Domain III: è‡ªå·±å—å®¹
        { id: "Q5", domain: "III. è‡ªå·±å—å®¹" },
        { id: "Q6", domain: "III. è‡ªå·±å—å®¹" },
        // Domain IV: ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—
        { id: "Q7", domain: "IV. ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—" },
        { id: "Q8", domain: "IV. ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—" },
        // Domain V: ã‚¢ãƒ³ã‚¬ãƒ¼ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ
        { id: "Q9", domain: "V. ã‚¢ãƒ³ã‚¬ãƒ¼ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ" },
        { id: "Q10", domain: "V. ã‚¢ãƒ³ã‚¬ãƒ¼ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ" },
        // Domain VI: ãƒªã‚«ãƒãƒªãƒ¼
        { id: "Q11", domain: "VI. ãƒªã‚«ãƒãƒªãƒ¼" },
        { id: "Q12", domain: "VI. ãƒªã‚«ãƒãƒªãƒ¼" },
        // Domain VII: è‡ªå¾‹æ€§
        { id: "Q13", domain: "VII. è‡ªå¾‹æ€§" },
        { id: "Q14", domain: "VII. è‡ªå¾‹æ€§" },
        { id: "Q15", domain: "VII. è‡ªå¾‹æ€§" }
    ];

    const DIAGNOSTIC_FEEDBACK = {
        "I. æ„›ç€ãƒ»å–œã³": {
            high_title: "ãƒã‚¸ãƒ†ã‚£ãƒ–ãƒ»ãƒ¬ã‚¾ãƒŠãƒ³ã‚¹ï¼ˆå…±é³´ï¼‰çŠ¶æ…‹",
            high_text: "è‚²å…ã®å¤§å¤‰ã•ã®ä¸­ã«ã‚ã£ã¦ã‚‚ã€å­ã©ã‚‚ã®å­˜åœ¨ã‹ã‚‰ã€Œã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼ˆå ±é…¬ï¼‰ã€ã‚’å—ã‘å–ã‚Œã¦ã„ã¾ã™ã€‚ã€Œä»Šã€ã“ã“ã€ã®å–œã³ã‚’å‘³ã‚ã†ä½™è£•ãŒã‚ã‚Šã€è„³ã®å ±é…¬ç³»ãŒæ´»æ€§åŒ–ã—ã¦ã„ã¾ã™ã€‚",
            low_title: "é–¢ä¿‚æ€§ã‚¢ãƒ³ãƒ˜ãƒ‰ãƒ‹ã‚¢ã¨ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸã‚±ã‚¢",
            low_text: "ã‚¹ãƒˆãƒ¬ã‚¹ã‚„ç–²åŠ´ã«ã‚ˆã‚Šè„³ãŒã€Œã‚µãƒã‚¤ãƒãƒ«ãƒ¢ãƒ¼ãƒ‰ã€ã«å…¥ã‚Šã€æ„›æƒ…å›è·¯ãŒä¸€æ™‚çš„ã«é®æ–­ã•ã‚Œã¦ã„ã¾ã™ã€‚ã€Œã‹ã‚ã„ãæ€ãˆãªã„ã€ã®ã¯å¿ƒãŒçœã‚¨ãƒãƒ¢ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ã‚‹ã‚µã‚¤ãƒ³ã§ã™ã€‚",
            advice: "æ„›æƒ…ãŒè¶³ã‚Šãªã„ã®ã§ã¯ãªãã€ç–²ã‚Œã™ãã¦è„³ãŒã€çœã‚¨ãƒãƒ¢ãƒ¼ãƒ‰ã€ã«ãªã£ã¦ã„ã‚‹ã ã‘ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã¾ãšã¯è¦ªã¨ã—ã¦ã®æ©Ÿèƒ½ã‚’å°‘ã—ä¼‘ã‚“ã§ã€å¿ƒã®æ„Ÿåº¦ã‚’å–ã‚Šæˆ»ã™ã“ã¨ã‹ã‚‰å§‹ã‚ã¾ã›ã‚“ã‹ï¼Ÿ"
        },
        "II. åŠ¹åŠ›æ„Ÿ": {
            high_title: "ãƒã‚¹ã‚¿ãƒªãƒ¼ï¼ˆç†Ÿé”ï¼‰ã¸ã®æŒ‘æˆ¦",
            high_text: "å­è‚²ã¦ã‚’ã€Œæ”»ç•¥å¯èƒ½ãªã‚²ãƒ¼ãƒ ã€ã®ã‚ˆã†ã«æ‰ãˆã€å¤±æ•—ã‚’å®Ÿé¨“ã®æ©Ÿä¼šã¨ã—ã¦æ¥½ã—ã‚€ç‹¬è‡ªã®ã€Œæˆé•·ãƒã‚¤ãƒ³ãƒ‰ã‚»ãƒƒãƒˆã€ãŒæ©Ÿèƒ½ã—ã¦ã„ã¾ã™ã€‚",
            low_title: "å­¦ç¿’æ€§ç„¡åŠ›æ„Ÿï¼ˆLearned Helplessnessï¼‰",
            low_text: "ã€Œä½•ã‚’ã—ã¦ã‚‚ç„¡é§„ã ã€ã¨ã„ã†æ·±ã„ç„¡åŠ›æ„Ÿã«æ”¯é…ã•ã‚Œã¦ã„ã¾ã™ã€‚è„³ãŒã€Œè¡Œå‹•ã¨çµæœã®å› æœé–¢ä¿‚ã€ã‚’ä¿¡ã˜ã‚‰ã‚Œãªããªã£ã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚",
            advice: "ã€Œã‚‚ã£ã¨é ‘å¼µã‚ã†ã€ã§ã¯ãªãã€ã€Œãƒãƒ¼ãƒ‰ãƒ«ã‚’æ¥µé™ã¾ã§ä¸‹ã’ã¦ã€å°ã•ãªæˆåŠŸä½“é¨“ï¼ˆã‚¹ãƒ¢ãƒ¼ãƒ«ã‚¦ã‚£ãƒ³ï¼‰ã‚’ä½œã‚ã†ã€ã¨ã„ã†æ„è­˜ãŒå¿…è¦ã§ã™ã€‚"
        },
        "III. è‡ªå·±å—å®¹": {
            high_title: "ã‚¤ãƒ³ãƒŠãƒ¼ãƒ»ã‚¢ãƒ©ã‚¤ï¼ˆå†…ãªã‚‹å‘³æ–¹ï¼‰",
            high_text: "å¤±æ•—ã—ã¦ã‚‚è‡ªåˆ†ã‚’è¦ªå‹ã®ã‚ˆã†ã«åŠ´ã‚ã‚‹ã“ã¨ãŒã§ãã¦ã„ã¾ã™ã€‚ã€Œå®Œç’§ãªè¦ªãªã©ã„ãªã„ã€ã¨ã„ã†å…±é€šã®äººé–“æ€§ã‚’ç†è§£ã—ã€å®‰å®šã—ã¦ã„ã¾ã™ã€‚",
            low_title: "ãƒˆã‚­ã‚·ãƒƒã‚¯ãƒ»ã‚·ã‚§ã‚¤ãƒ ï¼ˆæœ‰æ¯’ãªæ¥ï¼‰ã¨è‡ªå·±å‡¦ç½°",
            low_text: "å†…ãªã‚‹æ‰¹åˆ¤è€…ï¼ˆã‚¤ãƒ³ãƒŠãƒ¼ãƒ»ã‚¯ãƒªãƒ†ã‚£ãƒƒã‚¯ï¼‰ãŒå¸¸ã«ç›£è¦–ã—ã¦ãŠã‚Šã€åçœã§ã¯ãªãã€Œæ¥ã€ã®æ„Ÿæƒ…ã«ã‚ˆã£ã¦è‡ªåˆ†ã‚’æ¿€ã—ãæ”»æ’ƒã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚",
            advice: "ã€Œåçœä¼šã‚’ã‚„ã‚ã‚ˆã†ã€ã€Œè‡ªåˆ†ã¸ã®ãƒ€ãƒ¡å‡ºã—ã¯ã€ç™¾å®³ã‚ã£ã¦ä¸€åˆ©ãªã—ã€ã¨ã€æ€è€ƒã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚"
        },
        "IV. ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—": {
            high_title: "å¿ƒç†çš„å®‰å…¨æ€§ã¨ãƒ€ã‚¤ã‚¢ãƒ‡ã‚£ãƒƒã‚¯ãƒ»ã‚³ãƒ¼ãƒ”ãƒ³ã‚°",
            high_text: "ã€ŒèƒŒä¸­ã‚’é ã‘ã‚‰ã‚Œã‚‹æˆ¦å‹ã€ãŒã„ã‚‹å®‰å¿ƒæ„ŸãŒã‚ã‚Šã¾ã™ã€‚ã‚¹ãƒˆãƒ¬ã‚¹ã‚’äºŒäººã§å…±æœ‰ã—ã€å…±åŒã§å¯¾å‡¦ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ãŒæ©Ÿèƒ½ã—ã¦ã„ã¾ã™ã€‚",
            low_title: "å­¤ç‹¬ãªå­¤å¡ã¨ã‚²ãƒ¼ãƒˆã‚­ãƒ¼ãƒ”ãƒ³ã‚°",
            low_text: "ç›¸æ‰‹ã¸ã®è«¦ã‚ã‚„æ€’ã‚Šã‹ã‚‰ã€ã€Œå¿ƒç†çš„ãƒ¯ãƒ³ã‚ªãƒšã€çŠ¶æ…‹ã«é™¥ã£ã¦ã„ã¾ã™ã€‚ç„¡æ„è­˜ã«ç›¸æ‰‹ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã‚²ãƒ¼ãƒˆã‚­ãƒ¼ãƒ”ãƒ³ã‚°ãŒèµ·ãã¦ã„ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚",
            advice: "ç›¸æ‰‹ã‚’å¤‰ãˆã‚‹ã“ã¨ã‚ˆã‚Šã‚‚ã€ã€Œè‡ªåˆ†ã®è² æ‹…ã‚’å¯è¦–åŒ–ã—ã¦ä¼ãˆã‚‹ï¼ˆIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰ã€ã“ã¨ã‹ã‚‰å§‹ã‚ã¦ã¿ã¾ã—ã‚‡ã†ã€‚"
        },
        "V. ã‚¢ãƒ³ã‚¬ãƒ¼ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ": {
            high_title: "ã—ãªã‚„ã‹ãªå¾©å…ƒåŠ›ï¼ˆãƒ¬ã‚¸ãƒªã‚¨ãƒ³ã‚¹ï¼‰",
            high_text: "æ„Ÿæƒ…ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã ã‘ã§ãªãã€çˆ†ç™ºã—ã¦ã—ã¾ã£ãŸå¾Œã®ã€Œä¿®å¾©ï¼ˆãƒªãƒšã‚¢ï¼‰ã€ãŒã§ãã¦ã„ã¾ã™ã€‚å¤±æ•—ã‚’çµ†ã«å¤‰ãˆã‚‹åŠ›ãŒã‚ã‚Šã¾ã™ã€‚",
            low_title: "æ‰æ¡ƒä½“ãƒã‚¤ã‚¸ãƒ£ãƒƒã‚¯ã¨æ¥ã®èºæ—‹",
            low_text: "ç†æ€§ãŒé£›ã³ã€æƒ…å‹•è„³ï¼ˆæ‰æ¡ƒä½“ï¼‰ãŒæš´èµ°ã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚çˆ†ç™ºå¾Œã®æ¿€ã—ã„è‡ªå·±å«Œæ‚ªï¼ˆæ¥ï¼‰ãŒã€ã‹ãˆã£ã¦ä¿®å¾©ã‚’å¦¨ã’ã¦ã„ã¾ã™ã€‚",
            advice: "æ€’ã‚Šã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«æŠ€è¡“ã‚ˆã‚Šã‚‚ã€ã€Œçˆ†ç™ºã—ãŸå¾Œã®è‡ªåˆ†ã‚’è¨±ã—ã€å­ã©ã‚‚ã«è¬ã‚‹ã€ã¨ã„ã†ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒæ•‘ã„ã«ãªã‚Šã¾ã™ã€‚"
        },
        "VI. ãƒªã‚«ãƒãƒªãƒ¼": {
            high_title: "ç²å¾—å®‰å®šå‹ï¼ˆEarned Securityï¼‰",
            high_text: "éå»ã®çµŒé¨“ã‚’ä¹—ã‚Šè¶Šãˆã€è‡ªã‚‰ã®æ„å¿—ã§å®‰å¿ƒæ„Ÿã‚’ç²å¾—ã—ã¦ã„ã¾ã™ã€‚ã€ŒåŠ©ã‘ã¦ã€ã¨è¨€ãˆã‚‹å¼·ã•ãŒã€ã‚ãªãŸã¨å®¶æ—ã‚’å®ˆã£ã¦ã„ã¾ã™ã€‚",
            low_title: "è‚²å…å®¤ã®äº¡éœŠï¼ˆGhosts in the Nurseryï¼‰",
            low_text: "ç›®ã®å‰ã®å­ã©ã‚‚ã®è¡Œå‹•ã«ã€éå»ã®ãƒˆãƒ©ã‚¦ãƒã‚„è¦ªã®å½±ï¼ˆäº¡éœŠï¼‰ãŒé‡ãªã‚Šã€éå‰°ãªé˜²è¡›åå¿œï¼ˆææ€–ãƒ»æ€’ã‚Šï¼‰å¼•ãèµ·ã“ã•ã‚Œã¦ã„ã¾ã™ã€‚",
            advice: "ã‚ãªãŸã®ã›ã„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚éå»ã¨ç¾åœ¨ã¯åˆ‡ã‚Šé›¢ã›ã¾ã™ã€‚å°‚é–€å®¶ãªã©ã®ã€Œå®‰å…¨ãªä»–è€…ã€ã¨ã¤ãªãŒã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚"
        },
        "VII. è‡ªå¾‹æ€§": {
            high_title: "å½¹å‰²ã®çµ±åˆã¨è‡ªåˆ†æ™‚é–“ã®è¨±å¯",
            high_text: "è¦ªã¨ã—ã¦ã®å½¹å‰²ã¨ã€ä¸€äººã®äººé–“ã¨ã—ã¦ã®è‡ªåˆ†è‡ªèº«ã®ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Œã¦ã„ã¾ã™ã€‚è‡ªåˆ†ã‚’æº€ãŸã™ã“ã¨ãŒã€å®¶æ—ã¸ã®è²¢çŒ®ã«ãªã£ã¦ã„ã¾ã™ã€‚",
            low_title: "å½¹å‰²ã¸ã®åŸ‹æ²¡ï¼ˆRole Engulfmentï¼‰",
            low_text: "ã€Œè¦ªã ã‹ã‚‰ã€ã¨ã„ã†å½¹å‰²ã«é£²ã¿è¾¼ã¾ã‚Œã€è‡ªåˆ†ãŒé€æ˜äººé–“ã«ãªã£ãŸã‚ˆã†ãªç©ºè™šæ„Ÿã‚„ã€ç„¡æ„è­˜ã®çŠ ç‰²è€…æ„è­˜ã‚’æ„Ÿã˜ã¦ã„ã¾ã™ã€‚",
            advice: "ã€Œè¦ªä¸€æ—¦ä¼‘æ¥­ã€ã‚’è¨±å¯ã—ã¾ã—ã‚‡ã†ã€‚è‡ªåˆ†ã‚’å–ã‚Šæˆ»ã™æ™‚é–“ã¯ã€ã‚µãƒœã‚Šã§ã¯ãªãå¿…è¦ãªã‚¨ãƒãƒ«ã‚®ãƒ¼è£œçµ¦ã§ã™ã€‚"
        }
    };

    // --- Logic Implementation ---

    // 1. Calculate Domain Scores
    // Note: Input answers are 0-4. Python app uses 1-5.
    // We map 0->1, 1->2... (+1) to match the existing threshold logic (<=3.0 is Low).
    const domainScores = {};
    const domainCounts = {};

    answers.forEach((ans, index) => {
        if (index >= QUESTIONS.length) return;
        const q = QUESTIONS[index];
        const score = ans + 1; // Convert 0-4 to 1-5 scale

        if (!domainScores[q.domain]) {
            domainScores[q.domain] = 0;
            domainCounts[q.domain] = 0;
        }
        domainScores[q.domain] += score;
        domainCounts[q.domain] += 1;
    });

    // Calculate Averages
    const radarData = {};
    Object.keys(domainScores).forEach(domain => {
        radarData[domain] = domainScores[domain] / domainCounts[domain];
    });

    // 2. Identify Strongest Domain
    let bestDomain = null;
    let bestScore = -1;

    // Sorting to find best (if tie, picks first encountered)
    Object.entries(radarData).forEach(([domain, score]) => {
        if (score > bestScore) {
            bestScore = score;
            bestDomain = domain;
        }
    });

    // 3. Identify Low Scores (<= 3.0)
    const lowDomains = Object.entries(radarData)
        .filter(([_, score]) => score <= 3.0)
        .map(([domain, _]) => domain);

    // --- Construct Comment Text ---
    let commentText = "";

    // Part A: Strongest Point
    if (bestDomain && DIAGNOSTIC_FEEDBACK[bestDomain]) {
        const content = DIAGNOSTIC_FEEDBACK[bestDomain];
        commentText += `âœ¨ ä»Šæ—¥ã®å¼·ã¿: ${bestDomain}\n`;
        commentText += `**${content.high_title}**\n${content.high_text}\n\n`;
    }

    // Part B: SOS Signs (or Balanced Message)
    if (lowDomains.length > 0) {
        commentText += "ğŸ†˜ å¿ƒã‹ã‚‰ã®SOSã‚µã‚¤ãƒ³\n";
        commentText += "> ã‚¹ã‚³ã‚¢ãŒä½ã„é ˜åŸŸã¯ã€ã‚ãªãŸãŒæ‚ªã„ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚\n";
        commentText += "> ãã®éƒ¨åˆ†ãŒã€Œç–²ã‚Œã€ã‚„ã€Œã‚¹ãƒˆãƒ¬ã‚¹ã€ã§SOSã‚’å‡ºã—ã¦ã„ã‚‹ã‚µã‚¤ãƒ³ã§ã™ã€‚\n\n";

        lowDomains.forEach(domain => {
            if (DIAGNOSTIC_FEEDBACK[domain]) {
                const content = DIAGNOSTIC_FEEDBACK[domain];
                const score = radarData[domain].toFixed(1);
                commentText += `**${domain}** (ã‚¹ã‚³ã‚¢: ${score}) - ${content.low_title}\n`;
                commentText += `${content.low_text}\n\n`;
                commentText += `ğŸ€ ã‚¢ãƒ‰ãƒã‚¤ã‚¹\n${content.advice}\n\n`;
            }
        });

    } else {
        commentText += "å…¨ã¦ã®é ˜åŸŸã§ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Œã¦ã„ã¾ã™ï¼å¿ƒã®çŠ¶æ…‹ã¯éå¸¸ã«å®‰å®šã—ã¦ã„ã¾ã™ã€‚ã“ã®èª¿å­ã§è‡ªåˆ†ã‚’å¤§åˆ‡ã«ã—ã¦ãã ã•ã„ã€‚\n";
    }

    return {
        text: commentText.trim(),
        details: radarData // Optional: return scores if needed
    };
};
